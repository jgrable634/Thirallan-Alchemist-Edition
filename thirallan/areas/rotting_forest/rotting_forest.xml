<?xml version="1.0" encoding="utf-8" ?>
<areas>

  <include id="parallax/parallax.xml" />

  <area id="monastery_outside" width="50" height="100">
    <tiles id="blood_dirt" start="0" end="0.5" />
    <tiles id="obsidian" start="0.5" end="1" />
    <tiles id="blood_grass" y="0" />
    <tiles id="blackstone" y="99" />
    <ore id="blood_gem" start="0.4" end="0.5" percent="0.0025" tile="blood_dirt" />
    <ore id="iron" start="0.2" end="0.5" percent="0.0125" tile="blood_dirt" />
    <ore id="iron" start="0.1" end="0.2" percent="0.000625" tile="blood_dirt" />
    <ore id="coal" start="0.0" end="0.4" percent="0.0375" tile="blood_dirt" />
    <ore id="titanium" start="0.6" end="1.0" percent="0.0125" tile="obsidian" />
    <ore id="malumite_ore" start="0.6" end="1.0" percent="0.0375" tile="obsidian" />
    <ore id="gold" start="0.6" end="0.8" percent="0.0125" tile="obsidian" />
    <ore id="exotic_matter" start="0.9" end="1.0" percent="0.00025" tile="obsidian" />
    <ore id="quartz" start="0.6" end="0.7" percent="0.0125" tile="obsidian" />
    <ore id="uranium" start="0.7" end="1.0" percent="0.0025" tile="obsidian" />
    <ore id="lava" start="0.7" end="0.8" percent="1" tile="obsidian" />
    <objects id="blood_tree" count="6" fromX="5" toX="45" y="-1" />
  </area>

  <area id="thirallan_monastery" background="thirallan_monastery" width="186" height="100" looping="true" canFly="false" name="common.thirallan_monastery" planet="thirallan_alchemist">
    <action>for(y in -10...0) for(x in 50...55) {setTile(x,y,"monastery_stone");}</action>
    <action>for(y in -10...0) for(x in 126...131) {setTile(x,y,"monastery_stone");}</action>
    <tiles id="blood_dirt" start="0" end="0.5" />
    <tiles id="obsidian" start="0.5" end="1" />
    <tiles id="monastery_stone" y="0" />
    <tiles id="blackstone" y="99" />
    <ore id="blood_gem" start="0.4" end="0.5" percent="0.0025" tile="blood_dirt" />
    <ore id="iron" start="0.2" end="0.5" percent="0.0125" tile="blood_dirt" />
    <ore id="iron" start="0.1" end="0.2" percent="0.000625" tile="blood_dirt" />
    <ore id="coal" start="0.0" end="0.4" percent="0.0375" tile="blood_dirt" />
    <ore id="titanium" start="0.6" end="1.0" percent="0.0125" tile="obsidian" />
    <ore id="malumite_ore" start="0.6" end="1.0" percent="0.0375" tile="obsidian" />
    <ore id="gold" start="0.6" end="0.8" percent="0.0125" tile="obsidian" />
    <ore id="exotic_matter" start="0.9" end="1.0" percent="0.00025" tile="obsidian" />
    <ore id="quartz" start="0.6" end="0.7" percent="0.0125" tile="obsidian" />
    <ore id="uranium" start="0.7" end="1.0" percent="0.0025" tile="obsidian" />
    <ore id="lava" start="0.7" end="0.8" percent="1" tile="obsidian" />
    <object id="ligart" x="80" y="-1" />
    <object id="gilbert_monastery" x="105" y="-1" />
    <object id="hadvarr_monastery" x="110" y="-1" />
    <object id="azriel" x="56" y="-1" />
    <appendArea id="monastery_outside" offsetX="0" />
    <appendArea id="monastery_outside" offsetX="131" />
    <structure id="monastery_cathedral" x="85" y="-1" />
    <structure id="cathedral_entrance" x="91" y="-1" />
    <structure id="monastery_exit" x="68" y="-1" />
    <init><runAreaLoad/></init>
    <onLoad>
      <music id="thirallan_heights" seconds="1" />
      <section if="player.hasQuest('rebuild_monastery')">
        <section if="getFlag('merchants_recruited') && area.getStructureById('monastery_weaps_market') == null">
          <structure id="monastery_market" x="118" />
        </section>
        <section if="getFlag('andreas_recruited') && area.getObject('andreas_monastery') == null">
          <structure id="monastery.mines_entrance" x="110" />
          <object id="monastery.mines_entrance_decoy" x="111.5" />
          <structure id="monastery.mines_exit" x="111" y="2" />
          <object id="monastery.mines_exit_decoy" x="111.5" y="2" />
          <object id="andreas_monastery" x="111" y="2" />
          <action>for(x in 100...106) for(y in 1...7) mine(x,y); for(x in 106...108) for(y in 1...3) mine(x,y);</action>
          <structure id="storehouse" x="105" y="6" />
        </section>
      </section>
      <section if="area.getStructureById('cathedral_entrance') == null">
        <structure id="cathedral_entrance" x="91" y="-1" />
      </section>
    </onLoad>
  </area>

  <!--Legacy version of cathedral so old saves don't break-->
  <area id="thirallan_cathedral" width="22" height="1" shouldLight="false" canFly="false" external="thirallan_monastery" planet="thirallan_alchemist">
    <tiles id="monastery_stone" y="0" />
    <action>
      for(y in -30...0){setTile(0,y,"monastery_stone"); setTile(21,y,"monastery_stone");}
      for(x in 1...20) setTile(x,-10,"monastery_stone");
      for(y in -10...0){setTile(1,y,"steel_ladder"); setTile(20,y,"steel_ladder"); mine(1,y); mine(20,y);}
      for(x in 1...20) setTile(x,-20,"monastery_stone");
      for(y in -20...-10){setTile(1,y,"steel_ladder"); setTile(20,y,"steel_ladder"); mine(1,y); mine(20,y);}
    </action>
    <shape type="trapezoid">
      <top y="-40" fromX="10" toX="11" />
      <bottom y="-20" fromX="1" toX="19" />
    </shape>
    <action>
      for(x in 1...19) mine(x,-21);
    </action>
    <object id="gilbert_cathedral" x="4" y="-11" />
    <object id="hadvarr_cathedral" x="5" y="-1" />
    <object id="wall_parallax" x="2" y="-1" />
    <object id="wall_parallax" x="2" y="-11" />
    <object id="wall_parallax" x="2" y="-21" />
    <object id="wall_parallax" x="11" y="-1" />
    <object id="wall_parallax" x="11" y="-11" />
    <object id="wall_parallax" x="11" y="-21" />
    <object id="wall_parallax" x="1" y="-21" />
    <object id="wall_parallax" x="12" y="-21" />
    <structure id="cathedral_sanctuary" x="8" y="-11" />
    <structure id="cathedral_exit" x="9.5" y="-1" />
    <onLoad>
      <section if="getFlag('iterol_recruited') && area.getObject('iterol_cathedral') == null" >
        <object id="iterol_cathedral" x="6" y="-21" />
      </section>
      <action if="!area.isLit(1, -1)">for(y in -31...-1) for(x in 0...21) area.setLit(x, y);</action>
      <music id="holy_hills" seconds="1" />
      <teleport area="thirallan_monastery" x="87" y="-1" />
    </onLoad>
  </area>

  <!--Given Dimensions of Cathedral: 448x256, in tiles: 28x16-->
  <area id="thirallan_cathedral_new" width="28" height="1" shouldLight="false" canFly="false" external="thirallan_monastery" planet="thirallan_alchemist">
    <tiles id="monastery_stone" y="0" />
    <action>
      for(y in -15...0){setTile(0,y,"monastery_stone"); setTile(27, y, "monastery_stone");}
      for(x in 0...27) setTile(x, -15, "monastery_stone");
      for(y in -10...0){setTile(1,y,"wooden_ladder"); mine(1,y);}
      for(x in 22...27){setTile(x, -1, "wooden_ladder"); mine(x, -1);}
      for(x in 2...27) setTile(x,-10,"monastery_stone");
    </action>
    <object id="gilbert_cathedral" x="25" y="-11" />
    <object id="hadvarr_cathedral" x="5" y="-1" />
    <structure id="cathedral_altar" x="21" y="-1" />
    <structure id="cathedral_bg" x="0" y="-1" />
    <structure id="cathedral_window" x="7" y="-2" />
    <structure id="cathedral_window" x="14" y="-2" />
    <structure id="cathedral_window" x="21" y="-2" />
    <structure id="cathedral_ladder" x="1" y="-1" />
    <action>
      var pewCoord = 7;
      for(i in 0...6){
        var pos = pewCoord;
        area.addObject(ObjectInfo.make("cathedral_pew_fg", (pewCoord)*Tile.SIZE, -1*Tile.SIZE));
        area.addObject(ObjectInfo.make("cathedral_pew_bg", (pewCoord+0.5)*Tile.SIZE, -1*Tile.SIZE));
        pewCoord += 2;
      }
    </action>
    <structure id="cathedral_exit" x="2" y="-1" />
    
    <structure id="altar_cathedral_door" x="25" y="-2" />
    <structure id="cathedral_door" x="25" y="-11">
      <teleport area="placeholder_gilbert" x="5" y="-1" with="ellipse" />
    </structure>
    <structure id="cathedral_door" x="16" y="-11">
      <teleport area="placeholder_hadvarr" x="5" y="-1" with="ellipse" />
    </structure>
    <structure id="cathedral_door" x="8" y="-11">
      <teleport area="placeholder_misc" x="5" y="-1" with="ellipse" />
    </structure>
    <init><runAreaLoad/></init>
    <onLoad>
      <section if="getFlag('iterol_recruited') && area.getObject('iterol_cathedral') == null" >
        <object id="iterol_cathedral" x="6" y="-11" />
      </section>
      <action if="!area.isLit(1, -1)">for(y in -31...-1) for(x in 0...21) area.setLit(x, y);</action>
      <music id="holy_hills" seconds="1" />
    </onLoad>
  </area>

  <area id="cathedral_room_hrz_side" width="10" height="30">
    <tiles id="monastery_stone" start="0" end="1" />
  </area>
  <area id="cathedral_room_vrt_side" width="10" height="10">
    <tiles id="monastery_stone" start="0" end="1" />
  </area>

  <area id="monastery_gilbert" width="30" height="30" canFly="false" shouldLight="false">
    <appendArea id="cathedral_room_hrz_side" offsetX="0" offsetY="0" />
    <appendArea id="cathedral_room_hrz_side" offsetX="20" offsetY="0" />
    <appendArea id="cathedral_room_vrt_side" offsetX="10" offsetY="0" />
    <appendArea id="cathedral_room_vrt_side" offsetX="10" offsetY="15" />
    <structure id="cathedral_bg" x="5" y="20" />
    <structure id="cathedral_exit_ladder" x="10" y="14">
      <teleport area="thirallan_rotting_forest" x="75" y="-14" />
    </structure>
    <action>for(y in 5...10) mine(10, y);</action>
    <structure id="cathedral_door" x="16" y="14" />
    <object id="cathedral_desk" x="13" y="14" />
    <object id="cathedral_chair" x="14" y="14" />
    <object id="cathedral_dresser" x="19" y="14" />
  </area>

  <area id="paul_cell" width="12" height="9" canFly="false">
    <tiles id="monastery_dungeon_brick" start="0" end="1" />
    <action>for(x in 3...9) for(y in 3...6) setTile(x,y,null);</action>
    <structure id="dungeon_cell_bg" x="3" y="5" /> 
    <object id="chained_paul" x="8" y="5" />
    <object id="wall_torch" x="4" y="4" />
    <object id="wall_torch" x="7" y="4" />
    <structure id="monastery_dungeon_cell.ret" x="5" y="5" />
  </area>

  <area id="misc_cell" width="12" height="9" canFly="false">
    <tiles id="monastery_dungeon_brick" start="0" end="1" />
    <action>for(x in 3...9) for(y in 3...6) setTile(x,y,null);</action>
    <structure id="dungeon_cell_bg" x="3" y="5" /> 
    <object id="wall_torch" x="4" y="4" />
    <object id="wall_torch" x="7" y="4" />
    <structure id="monastery_dungeon_cell.ret" x="5" y="5" />
  </area>

  <area id="monastery_dungeon" height="1" corrupted="true" planet="thirallan_alchemist" canFly="false">
      <tiles from="monastery_dungeon.png" x="0" y="-1">
            <!--Stone & Dungeon Brick--><tile id="stone" color="655e5e" /><tile id="monastery_dungeon_brick" color="434741" />
            <!--Empty Air in Dungeon--><tile id="stone" color="0a0fba">setTile(x, y, null)</tile>
            <!--Dungeon Brick Back--><tile id="monastery_dungeon_brick_back" color="252725" layer="back" />
            <!--Dungeon BG--><tile id="monastery_dungeon_brick_back" color="b6eeec">getStructure("dungeon_bg").build(null, area, x*Tile.SIZE, y*Tile.SIZE); setTile(x,y, null);</tile>
            <!--Cobwebs--><tile id="monastery_dungeon_brick_back" color="eeeeee">area.addObject(ObjectInfo.make((!area.isEmptyTile(x-1, y)?("alch_cobweb"):("alch_cobweb_flip")), x*Tile.SIZE, y*Tile.SIZE)); setTile(x,y, null);</tile>
            <!--Closed Bars--><tile id="monastery_dungeon_brick_back" color="000000">area.addObject(ObjectInfo.make("dungeon_bars_closed", x*Tile.SIZE, y*Tile.SIZE)); setTile(x,y, null);</tile>
            <!--Open Bars--><tile id="monastery_dungeon_brick_back" color="6500c5" layer="back">area.addObject(ObjectInfo.make("dungeon_bars_open", x*Tile.SIZE, y*Tile.SIZE))</tile>
            <!--Corrupted Bars--><tile id="monastery_dungeon_brick_back" color="35006b">area.addObject(ObjectInfo.make("dungeon_bars_trap", x*Tile.SIZE, y*Tile.SIZE)); setTile(x,y, null);</tile>
            <!--Key--><tile id="monastery_dungeon_brick_back" color="ffde00">area.addObject(ObjectInfo.make("monastery_dungeon_key", x*Tile.SIZE, y*Tile.SIZE)); setTile(x,y, null);</tile>
            <!--Torches--><tile id="monastery_dungeon_brick_back" color="665308">area.addObject(ObjectInfo.make("wall_torch", x*Tile.SIZE, y*Tile.SIZE)); setTile(x,y, null);</tile>
            <!--Dungeon Exit--><tile id="monastery_dungeon_brick_back" color="80520b">getStructure("monastery_dungeon_exit").build(null, area, x*Tile.SIZE, y*Tile.SIZE); setTile(x,y, null);</tile>
            <!--Paul's Cell--><tile id="monastery_dungeon_brick_back" color="644009">getStructure("monastery_dungeon_paul").build(null, area, x*Tile.SIZE, y*Tile.SIZE); setTile(x,y, null);</tile>
            <!--Misc. Cell--><tile id="monastery_dungeon_brick_back" color="563708">getStructure("monastery_dungeon_misc").build(null, area, x*Tile.SIZE, y*Tile.SIZE); setTile(x,y, null);</tile>
            <!--Ladders--><tile id="wooden_ladder" color="6d6d6d" layer="back" />
            <!--Fake Wall--><tile id="monastery_dungeon_brick_back" color="5b5f56" layer="back">area.addObject(ObjectInfo.make("fake_dungeon_wall", x*Tile.SIZE, y*Tile.SIZE))</tile>
      </tiles>

      <tiles id="blackstone" y="0" />
      <tiles id="blackstone" y="27" />
      <tiles id="blackstone" x="0" />
      <tiles id="blackstone" x="50" />

      <structure id="cathedral_half_ladder" x="15" y="17" />
      <structure id="cathedral_half_ladder" x="22" y="19" />
      <structure id="cathedral_half_ladder" x="31" y="19" />
      <light x="11" y="17" size="30" />
      <init>
        <runAreaLoad/>
      </init>
      <onLoad>
        <music id="church_dungeon" seconds="1" />
        <section if="getFlag('dungeon_conflict')">
          <run procedure="dungeon_conflict" />
        </section>
      </onLoad>
    </area>


  <area id="thirallan_rotting_forest" background="thirallan_rotting_forest" width="150" height="100" looping="true" corrupted="true" planet="thirallan_alchemist">
    <tiles id="blood_dirt" start="0" end="0.5" />
    <tiles id="obsidian" start="0.5" end="1" />
    <tiles id="blood_grass" y="0" />
    <tiles id="blackstone" y="99" />
    <ore id="blood_gem" start="0.4" end="0.5" percent="0.0025" tile="blood_dirt" />
    <ore id="iron" start="0.2" end="0.5" percent="0.0125" tile="blood_dirt" />
    <ore id="iron" start="0.1" end="0.2" percent="0.000625" tile="blood_dirt" />
    <ore id="coal" start="0.0" end="0.4" percent="0.0375" tile="blood_dirt" />
    <ore id="titanium" start="0.6" end="1.0" percent="0.0125" tile="obsidian" />
    <ore id="malumite_ore" start="0.6" end="1.0" percent="0.0375" tile="obsidian" />
    <ore id="gold" start="0.6" end="0.8" percent="0.0125" tile="obsidian" />
    <ore id="exotic_matter" start="0.9" end="1.0" percent="0.00025" tile="obsidian" />
    <ore id="quartz" start="0.6" end="0.7" percent="0.0125" tile="obsidian" />
    <ore id="uranium" start="0.7" end="1.0" percent="0.0025" tile="obsidian" />
    <ore id="lava" start="0.7" end="0.8" percent="1" tile="obsidian" />
    <objects id="blood_tree" startX="0" endX="50" y="-1" minDist="6" maxDist="9" array="right" />
    <objects id="blood_tree" startX="100" endX="150" y="-1" minDist="6" maxDist="9" array="right" />
    <structure id="undead_shrine.thirallan_rotting_forest" x="125" y="-1" />
    <structure id="monastery_entrance" x="59" y="-1" />
    <structure id="monastery_bell" x="73" y="-12" />
    <init><runAreaLoad/></init>
    <onLoad>
      <music id="thirallan_heights" seconds="1" />
      <section if="area.getStructureById('monastery_entrance_door') == null">
        <structure id="monastery_entrance_door" x="72.90625" y="-1" />
        <structure id="monastery_bell" x="73" y="-12" />
      </section>
    </onLoad>
  </area>



</areas>
